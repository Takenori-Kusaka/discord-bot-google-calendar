# ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆæ›¸

## æ¦‚è¦

åŸ·äº‹ã€Œé»’ç”°ã€ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ ã¯ã€Claude Tool Useï¼ˆFunction Callingï¼‰ã‚’åŸºç›¤ã¨ã—ã¦ã€
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ„å›³ã‚’ç†è§£ã—ã€é©åˆ‡ãªãƒ„ãƒ¼ãƒ«ã‚’é¸æŠãƒ»å®Ÿè¡Œã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Discord Bot                           â”‚
â”‚                     (ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å—ä¿¡)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Claude Agent (Orchestrator)                â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Tool Router                       â”‚   â”‚
â”‚  â”‚  - ãƒ¦ãƒ¼ã‚¶ãƒ¼æ„å›³ã®è§£æ                               â”‚   â”‚
â”‚  â”‚  - é©åˆ‡ãªãƒ„ãƒ¼ãƒ«ã®é¸æŠ                               â”‚   â”‚
â”‚  â”‚  - ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œçµæœã®çµ±åˆ                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                           â”‚                                 â”‚
â”‚                           â–¼                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                  Available Tools                     â”‚   â”‚
â”‚  â”‚                                                      â”‚   â”‚
â”‚  â”‚  ğŸ“… calendar_tool      - ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼äºˆå®šç¢ºèª         â”‚   â”‚
â”‚  â”‚  ğŸŒ¤ï¸ weather_tool       - å¤©æ°—äºˆå ±å–å¾—               â”‚   â”‚
â”‚  â”‚  ğŸ‰ event_tool         - åœ°åŸŸã‚¤ãƒ™ãƒ³ãƒˆæ¤œç´¢           â”‚   â”‚
â”‚  â”‚  ğŸ“‹ life_info_tool     - ç”Ÿæ´»å½±éŸ¿æƒ…å ±ç¢ºèª           â”‚   â”‚
â”‚  â”‚  ğŸ“† today_info_tool    - ä»Šæ—¥ã¯ä½•ã®æ—¥               â”‚   â”‚
â”‚  â”‚  ğŸ½ï¸ restaurant_tool    - ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³æ¤œç´¢ï¼ˆå°†æ¥ï¼‰     â”‚   â”‚
â”‚  â”‚  ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ family_tool        - å®¶æ—æƒ…å ±å‚ç…§             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Response Generator                       â”‚
â”‚                   (åŸ·äº‹å£èª¿ã§å¿œç­”ç”Ÿæˆ)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Tool Use è¨­è¨ˆ

### ãƒ„ãƒ¼ãƒ«å®šç¾©ã‚¹ã‚­ãƒ¼ãƒ

```python
TOOLS = [
    {
        "name": "get_calendar_events",
        "description": "Googleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‹ã‚‰äºˆå®šã‚’å–å¾—ã—ã¾ã™ã€‚ä»Šæ—¥ã€æ˜æ—¥ã€ä»Šé€±ãªã©ã®äºˆå®šã‚’ç¢ºèªã§ãã¾ã™ã€‚",
        "input_schema": {
            "type": "object",
            "properties": {
                "date_range": {
                    "type": "string",
                    "enum": ["today", "tomorrow", "this_week", "next_week"],
                    "description": "å–å¾—ã™ã‚‹æœŸé–“"
                }
            },
            "required": ["date_range"]
        }
    },
    {
        "name": "get_weather",
        "description": "æœ¨æ´¥å·å¸‚ã®å¤©æ°—äºˆå ±ã‚’å–å¾—ã—ã¾ã™ã€‚",
        "input_schema": {
            "type": "object",
            "properties": {
                "days": {
                    "type": "integer",
                    "description": "ä½•æ—¥åˆ†ã®äºˆå ±ã‚’å–å¾—ã™ã‚‹ã‹ï¼ˆ1-7ï¼‰",
                    "default": 1
                }
            }
        }
    },
    {
        "name": "search_events",
        "description": "æœ¨æ´¥å·å¸‚ãƒ»å¥ˆè‰¯å¸‚å‘¨è¾ºã®åœ°åŸŸã‚¤ãƒ™ãƒ³ãƒˆã‚’æ¤œç´¢ã—ã¾ã™ã€‚",
        "input_schema": {
            "type": "object",
            "properties": {
                "query": {
                    "type": "string",
                    "description": "æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼ˆä¾‹: å­ä¾›å‘ã‘ã€é€±æœ«ã€ç„¡æ–™ï¼‰"
                }
            }
        }
    },
    {
        "name": "get_life_info",
        "description": "å®¶æ—ã«é–¢é€£ã™ã‚‹æ³•æ”¹æ­£ã‚„åˆ¶åº¦å¤‰æ›´ãªã©ã®ç”Ÿæ´»å½±éŸ¿æƒ…å ±ã‚’å–å¾—ã—ã¾ã™ã€‚",
        "input_schema": {
            "type": "object",
            "properties": {}
        }
    },
    {
        "name": "get_today_info",
        "description": "ä»Šæ—¥ãŒä½•ã®æ—¥ã‹ã‚’å–å¾—ã—ã¾ã™ã€‚è¨˜å¿µæ—¥ã‚„è±†çŸ¥è­˜ã‚’æä¾›ã—ã¾ã™ã€‚",
        "input_schema": {
            "type": "object",
            "properties": {}
        }
    },
    {
        "name": "get_family_info",
        "description": "å®¶æ—æƒ…å ±ï¼ˆã‚´ãƒŸå‡ºã—æ—¥ã€ã‚ˆãè¡Œãå ´æ‰€ãªã©ï¼‰ã‚’å‚ç…§ã—ã¾ã™ã€‚",
        "input_schema": {
            "type": "object",
            "properties": {
                "category": {
                    "type": "string",
                    "enum": ["garbage", "favorite_places", "all"],
                    "description": "å–å¾—ã™ã‚‹æƒ…å ±ã‚«ãƒ†ã‚´ãƒª"
                }
            },
            "required": ["category"]
        }
    }
]
```

## å‡¦ç†ãƒ•ãƒ­ãƒ¼

### 1. åŸºæœ¬ãƒ•ãƒ­ãƒ¼

```
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å—ä¿¡
   â†“
2. Claude APIã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨ãƒ„ãƒ¼ãƒ«å®šç¾©ã‚’é€ä¿¡
   â†“
3. ClaudeãŒãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ã‚’åˆ¤æ–­
   â”œâ”€â”€ ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ã‚ã‚Š â†’ 4ã¸
   â””â”€â”€ ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ãªã— â†’ 7ã¸ï¼ˆç›´æ¥å¿œç­”ï¼‰
   â†“
4. ãƒ„ãƒ¼ãƒ«ã‚’å®Ÿè¡Œï¼ˆè¤‡æ•°ã®å ´åˆã¯ä¸¦åˆ—å®Ÿè¡Œï¼‰
   â†“
5. ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œçµæœã‚’Claudeã«è¿”å´
   â†“
6. ClaudeãŒçµæœã‚’çµ±åˆã—ã€æœ€çµ‚å¿œç­”ã‚’ç”Ÿæˆ
   â†“
7. åŸ·äº‹å£èª¿ã§å¿œç­”
```

### 2. è¤‡æ•°ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œä¾‹

**ãƒ¦ãƒ¼ã‚¶ãƒ¼**: ã€Œä»Šé€±æœ«ã®äºˆå®šã¨å¤©æ°—ã‚’æ•™ãˆã¦ã€

```
1. Claudeåˆ¤æ–­: get_calendar_events + get_weather ãŒå¿…è¦
2. ä¸¦åˆ—å®Ÿè¡Œ:
   - get_calendar_events(date_range="this_week")
   - get_weather(days=7)
3. çµæœçµ±åˆ:
   - åœŸæ—¥ã®äºˆå®š + åœŸæ—¥ã®å¤©æ°—
4. å¿œç­”ç”Ÿæˆ:
   ã€Œæ—¦é‚£æ§˜ã€ä»Šé€±æœ«ã®ã”äºˆå®šã§ã”ã–ã„ã¾ã™ã€‚
    åœŸæ›œæ—¥ã¯ç‰¹ã«ã”äºˆå®šã¯ã”ã–ã„ã¾ã›ã‚“ã€‚å¤©æ°—ã¯æ™´ã‚Œã€æœ€é«˜æ°—æ¸©12åº¦ã®äºˆå ±ã§ã™ã€‚
    æ—¥æ›œæ—¥ã¯ã€Œå®¶æ—ã§ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°ã€ãŒã”ã–ã„ã¾ã™ã€‚ã“ã¡ã‚‰ã‚‚æ™´ã‚Œã®äºˆå ±ã§ã”ã–ã„ã¾ã™ã€‚ã€
```

## ãƒ„ãƒ¼ãƒ«å®Ÿè£…

### ToolExecutor ã‚¯ãƒ©ã‚¹

```python
class ToolExecutor:
    """ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œå™¨"""

    def __init__(
        self,
        calendar_client: GoogleCalendarClient,
        weather_client: WeatherClient,
        event_search_client: EventSearchClient,
        life_info_client: LifeInfoClient,
        today_info_client: TodayInfoClient,
        family_data: dict,
    ):
        self.tools = {
            "get_calendar_events": self._get_calendar_events,
            "get_weather": self._get_weather,
            "search_events": self._search_events,
            "get_life_info": self._get_life_info,
            "get_today_info": self._get_today_info,
            "get_family_info": self._get_family_info,
        }

    async def execute(self, tool_name: str, tool_input: dict) -> str:
        """ãƒ„ãƒ¼ãƒ«ã‚’å®Ÿè¡Œ"""
        if tool_name not in self.tools:
            return f"Error: Unknown tool {tool_name}"

        return await self.tools[tool_name](tool_input)
```

## å°†æ¥æ‹¡å¼µ: ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ§‹æˆ

### æ¤œè¨äº‹é …

å­¦ç¿’ç›®çš„ã§ã®ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ§‹æˆã¨ã—ã¦ã€ä»¥ä¸‹ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¤œè¨ï¼š

#### ãƒ‘ã‚¿ãƒ¼ãƒ³1: å°‚é–€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Orchestrator Agent              â”‚
â”‚         (ã‚¿ã‚¹ã‚¯åˆ†è§£ãƒ»ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå‰²å½“)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼             â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Calendar     â”‚ â”‚ Information  â”‚ â”‚ Search       â”‚
â”‚ Agent        â”‚ â”‚ Agent        â”‚ â”‚ Agent        â”‚
â”‚ (äºˆå®šç®¡ç†)    â”‚ â”‚ (æƒ…å ±åé›†)    â”‚ â”‚ (æ¤œç´¢å®Ÿè¡Œ)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ãƒ‘ã‚¿ãƒ¼ãƒ³2: LangGraphæ´»ç”¨

```python
from langgraph.graph import StateGraph

# çŠ¶æ…‹å®šç¾©
class AgentState(TypedDict):
    messages: list
    current_agent: str
    tool_results: dict

# ã‚°ãƒ©ãƒ•æ§‹ç¯‰
graph = StateGraph(AgentState)
graph.add_node("router", router_node)
graph.add_node("calendar_agent", calendar_agent_node)
graph.add_node("search_agent", search_agent_node)
graph.add_node("response_generator", response_node)

# ã‚¨ãƒƒã‚¸å®šç¾©
graph.add_conditional_edges("router", route_to_agent)
```

### å®Ÿè£…å„ªå…ˆåº¦

1. **MVP**: å˜ä¸€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ + Tool Useï¼ˆç¾åœ¨ã®æ‹¡å¼µï¼‰
2. **å­¦ç¿’ãƒ•ã‚§ãƒ¼ã‚º**: LangGraphã«ã‚ˆã‚‹ã‚°ãƒ©ãƒ•ãƒ™ãƒ¼ã‚¹å®Ÿè£…
3. **å°†æ¥**: æœ¬æ ¼çš„ãªãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ§‹æˆ

## å‚è€ƒè³‡æ–™

- [Anthropic Tool Use Documentation](https://docs.anthropic.com/claude/docs/tool-use)
- [LangGraph Documentation](https://langchain-ai.github.io/langgraph/)
- [Claude Function Calling Best Practices](https://docs.anthropic.com/claude/docs/tool-use#best-practices)
